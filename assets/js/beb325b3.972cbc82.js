"use strict";(self.webpackChunksimpleiot=self.webpackChunksimpleiot||[]).push([[8550],{3905:(t,e,a)=>{a.d(e,{Zo:()=>d,kt:()=>u});var n=a(7294);function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){i(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function l(t,e){if(null==t)return{};var a,n,i=function(t,e){if(null==t)return{};var a,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||(i[a]=t[a]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}var s=n.createContext({}),m=function(t){var e=n.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):r(r({},e),t)),a},d=function(t){var e=m(t.components);return n.createElement(s.Provider,{value:e},t.children)},c={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},p=n.forwardRef((function(t,e){var a=t.components,i=t.mdxType,o=t.originalType,s=t.parentName,d=l(t,["components","mdxType","originalType","parentName"]),p=m(a),u=i,h=p["".concat(s,".").concat(u)]||p[u]||c[u]||o;return a?n.createElement(h,r(r({ref:e},d),{},{components:a})):n.createElement(h,r({ref:e},d))}));function u(t,e){var a=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var o=a.length,r=new Array(o);r[0]=p;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:i,r[1]=l;for(var m=2;m<o;m++)r[m]=a[m];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},7725:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>m});var n=a(7462),i=(a(7294),a(3905));const o={id:"flow",title:"Data Flow"},r=void 0,l={unversionedId:"documentation/data/flow",id:"documentation/data/flow",title:"Data Flow",description:"Architecture",source:"@site/docs/documentation/data/flow.md",sourceDirName:"documentation/data",slug:"/documentation/data/flow",permalink:"/simpleiot-build/docs/documentation/data/flow",draft:!1,tags:[],version:"current",frontMatter:{id:"flow",title:"Data Flow"},sidebar:"theSidebar",previous:{title:"Introduction",permalink:"/simpleiot-build/docs/documentation/data/intro"},next:{title:"Common Interfaces and APIs",permalink:"/simpleiot-build/docs/documentation/data/common"}},s={},m=[{value:"Architecture",id:"architecture",level:2},{value:"Common Data Pathway",id:"common-data-pathway",level:2},{value:"Monitoring Live Data",id:"monitoring-live-data",level:2},{value:"Data Visualization",id:"data-visualization",level:2}],d={toc:m};function c(t){let{components:e,...a}=t;return(0,i.kt)("wrapper",(0,n.Z)({},d,a,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"architecture"},"Architecture"),(0,i.kt)("p",null,"Each time the ",(0,i.kt)("a",{parentName:"p",href:"/docs/install/intro"},"SimpleIOT Installer")," is run, the following set of services are created and stitched together:"),(0,i.kt)("div",{align:"center"},(0,i.kt)("img",{src:"/img/data/architecture.png",width:"100%"})),(0,i.kt)("p",null,"The system is designed to accept data from devices (via ",(0,i.kt)("a",{parentName:"p",href:"https://mqtt.org/"},"MQTT"),") as well as programmatically via REST APIs."),(0,i.kt)("p",null,"The default system maintains three different data storage mechanisms:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/rds/postgresql/"},"Amazon RDS/Postgres"),": A SQL-based database for storing information about Projects, Models, DataTypes, and the last known value of each Data element. It also acts as a repository for the registration of device instances and metadata."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/dynamodb"},"Amazon DynamoDB"),": A NoSQL database where individual IoT data transactions are stored. You can retrieve every data item sent via MQTT or API into the system."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/timestream/"},"Amazon Timestream"),": A scalable, serverless time series database.",(0,i.kt)("p",null),(0,i.kt)("div",{align:"center"},(0,i.kt)("img",{src:"/img/data/dataflow.png",width:"70%"})))),(0,i.kt)("p",null,"AWS IOT Core has a built-in rule-based system, where incoming MQTT messages can be filtered based on a SQL-like syntax:"),(0,i.kt)("div",{align:"center"},(0,i.kt)("img",{src:"/img/data/iot-core-sql.png",width:"70%"})),(0,i.kt)("p",null,"Messages can then be routed to a variety of destinations:"),(0,i.kt)("div",{align:"center"},(0,i.kt)("img",{src:"/img/data/iot-target-list.png",width:"70%"})),(0,i.kt)("h2",{id:"common-data-pathway"},"Common Data Pathway"),(0,i.kt)("p",null,"In SimpleIOT, all messages are routed to a Lambda function (called ",(0,i.kt)("em",{parentName:"p"},"iot_dev_api_data"),"). Here, the data is transformed and modified before being sent by the function to the above destinations. Finally, the lambda validates that the data name matches a defined ",(0,i.kt)("strong",{parentName:"p"},"Datatype")," in a ",(0,i.kt)("strong",{parentName:"p"},"Model")," and only allows the data to be saved."),(0,i.kt)("p",null,"However, you can add your own IOT Rules and send copies of the payload to other locations."),(0,i.kt)("p",null,"This architecture allows REST API calls via API Gateway to the same Lambda function. This way, REST API calls, and MQTT data go through the same code path. This facilitates supporting a ",(0,i.kt)("em",{parentName:"p"},"Digital Twin")," for physical data. "),(0,i.kt)("p",null,"The same API is invoked by the ",(0,i.kt)("a",{parentName:"p",href:"/docs/documentation/cli/intro"},"SimpleIOT Command Line Interface (CLI)"),", allowing command-line interactions with the twin and remote physical devices."),(0,i.kt)("p",null,"This way, data may be sent, viewed, or modified, from a variety of sources:"),(0,i.kt)("div",{align:"center"},(0,i.kt)("img",{src:"/img/data/source-flow.png",width:"90%"})),(0,i.kt)("h2",{id:"monitoring-live-data"},"Monitoring Live Data"),(0,i.kt)("p",null,"Whenever this lambda receives a data element, if the Datatype element is marked so it should be shown on a Digital Twin, an MQTT message is broadcast on a pre-defined 'monitor' MQTT topic. This is useful for monitoring traffic on the system during development and is used by the ",(0,i.kt)("a",{parentName:"p",href:"/docs/documentation/cli/device#iot-device-monitor"},"iot data monitor")," to display the state change of a single data element on a device."),(0,i.kt)("p",null,"All data changes (whether MQTT or REST) go through the same lambda function. This lambda does the re-publishing of the data change to the monitor topic. This means that any call to REST API calls (i.e., via the CLI) will invoke an MQTT monitor message which will update in real-time."),(0,i.kt)("p",null,"You can disable this behavior by modifying an individual ",(0,i.kt)("a",{parentName:"p",href:"/docs/documentation/cli/datatype"},"Datatype")," and setting ",(0,i.kt)("inlineCode",{parentName:"p"},"show_on_twin")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,i.kt)("h2",{id:"data-visualization"},"Data Visualization"),(0,i.kt)("div",{align:"center"},(0,i.kt)("img",{src:"/img/data/data-visualization.png",width:"60%"}),(0,i.kt)("p",null)),"Once the data has made it to the cloud side, you can make use of the data in a variety of ways:",(0,i.kt)("p",null),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://grafana.com/grafana/"},"Grafana"),". Easy way to build a graphic dashboard. You can take advantage of the fully-managed version with a built-in Timestream connector: ",(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/grafana"},"Amazon Managed Grafana")," - ",(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/timestream/latest/developerguide/Grafana.html"},"[Timestream instructions]")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/timestream/latest/developerguide/Quicksight.html"},"Amazon QuickSight"),": Serverless BI platform - ",(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/timestream/latest/developerguide/Quicksight.html"},"[Timestream instructions]")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/pm/sagemaker/"},"Amazon SageMaker"),": fully-managed AI/ML platform - ",(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/timestream/latest/developerguide/Sagemaker.html"},"[Timestream instructions]"))),(0,i.kt)("p",null,"As mentioned above, you can also route all IoT traffic to other services or trigger events via IoT Core rules:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/iotanalytics/latest/userguide/data-visualization.html"},"AWS IoT Analytics"),": managed IoT analytics platform - ",(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/iotanalytics/latest/userguide/quickstart.html"},"[Instructions]"))),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Only MQTT data routed through IoT Core will be sent to other destinations. However, if you want to send both MQTT and REST data, you can modify the ",(0,i.kt)("em",{parentName:"p"},"iot_dev_api_data")," lambda function and redirect the data from there.")))}c.isMDXComponent=!0}}]);